#!/usr/bin/env bash
# This Bash script installs nginx and configures /redirect_me to return a 301 redirect

apt-get update -y
apt-get install -y nginx

# Root page
echo "Holberton School for the win!" > /var/www/html/index.html

# Add a location block for /redirect_me (handles trailing slash)
sed -i "s|try_files \$uri \$uri/ =404;|try_files \$uri \$uri/ =404;\n\n\tlocation /redirect_me {\n\t\treturn 301 https://www.youtube.com/watch?v=QH2-TGUlwu4;\n\t}\n\tlocation /redirect_me/ {\n\t\treturn 301 https://www.youtube.com/watch?v=QH2-TGUlwu4;\n\t}|g" /etc/nginx/sites-available/default

# Check syntax
nginx -t

# Start Nginx if not running, else reload to apply changes
if pgrep nginx >/dev/null 2>&1; then
    service nginx reload
else
    service nginx start
fi
