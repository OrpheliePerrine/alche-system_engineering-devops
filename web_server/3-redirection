#!/usr/bin/env bash
# This Bash script installs nginx and configures /redirect_me to return a 301 redirect

# Update and install nginx
apt-get update -y
apt-get install -y nginx

# Create the root page
echo "Holberton School for the win!" > /var/www/html/index.html

# Use sed to add a /redirect_me location that returns 301
sed -i "s|try_files \$uri \$uri/ =404;|try_files \$uri \$uri/ =404;\n\n\tlocation /redirect_me {\n\t\treturn 301 https://www.youtube.com/watch?v=QH2-TGUlwu4;\n\t}|g" /etc/nginx/sites-available/default

# Make sure the config syntax is valid
nginx -t

# Start Nginx (fresh machine) or reload if already running
if pgrep nginx >/dev/null 2>&1; then
    service nginx reload
else
    service nginx start
fi
